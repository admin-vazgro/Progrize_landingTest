"use strict";exports.id=1,exports.ids=[1],exports.modules={2001:(a,b,c)=>{c.d(b,{A:()=>j});var d=c(8249),e=c(7484),f=c(5990),g=c(9099),h=c(1220);function i({postId:a,currentUserId:b,onUpdate:c}){let i=(0,g.useRouter)(),[j,k]=(0,e.useState)([]),[l,m]=(0,e.useState)(""),[n,o]=(0,e.useState)(!1),p=(0,e.useCallback)(async()=>{try{let{data:b,error:c}=await f.N.from("comments").select("*").eq("post_id",a).order("created_at",{ascending:!0});if(c)throw c;let d=await Promise.all((b||[]).map(async a=>{let{data:b}=await f.N.from("profiles").select("full_name, avatar_url").eq("id",a.user_id).single();return{...a,user_name:b?.full_name||"User",user_avatar:b?.avatar_url||""}}));k(d)}catch(a){console.error("Error loading comments:",a)}},[a]),q=async d=>{if(d.preventDefault(),l.trim()){o(!0);try{let{error:d}=await f.N.from("comments").insert({post_id:a,user_id:b,content:l.trim()});if(d)throw d;await f.N.rpc("increment_comments",{post_id:a});let{data:e}=await f.N.from("posts").select("user_id, title").eq("id",a).single();if(e?.user_id&&e.user_id!==b){let{error:c}=await f.N.from("notifications").insert({user_id:e.user_id,actor_id:b,type:"comment",entity_type:"post",entity_id:a,meta:{title:e.title}});c&&console.error("Error creating notification:",c)}m(""),await p(),c()}catch(a){console.error("Error posting comment:",a)}finally{o(!1)}}},r=(a,b)=>{b.stopPropagation(),i.push(`/user/${a}`)};return(0,d.jsxs)("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[(0,d.jsx)("div",{className:"space-y-4 mb-4",children:0===j.length?(0,d.jsx)("p",{className:"text-sm text-gray-500 text-center py-4",children:"No comments yet. Be the first to comment!"}):j.map(a=>{let b,c,e,f;return(0,d.jsxs)("div",{className:"flex gap-3",children:[(0,d.jsx)("div",{className:"cursor-pointer hover:opacity-80 transition",onClick:b=>r(a.user_id,b),children:a.user_avatar?(0,d.jsx)(h.default,{src:a.user_avatar,alt:a.user_name,width:32,height:32,className:"rounded-full object-cover"}):(0,d.jsx)("div",{className:"w-8 h-8 rounded-full bg-[#162f16] text-white flex items-center justify-center text-sm font-semibold",children:a.user_name.charAt(0).toUpperCase()})}),(0,d.jsxs)("div",{className:"flex-1",children:[(0,d.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3",children:[(0,d.jsx)("p",{className:"font-medium text-sm text-gray-900 cursor-pointer hover:underline",onClick:b=>r(a.user_id,b),children:a.user_name}),(0,d.jsx)("p",{className:"text-sm text-gray-700 mt-1",children:a.content})]}),(0,d.jsx)("p",{className:"text-xs text-gray-500 mt-1 ml-3",children:(b=new Date(a.created_at),f=Math.floor((e=Math.floor((c=Math.floor((new Date().getTime()-b.getTime())/6e4))/60))/24),c<1?"Just now":c<60?`${c}m ago`:e<24?`${e}h ago`:`${f}d ago`)})]})]},a.id)})}),(0,d.jsxs)("form",{onSubmit:q,className:"flex gap-3",children:[(0,d.jsx)("input",{type:"text",value:l,onChange:a=>m(a.target.value),placeholder:"Write a comment...",className:"flex-1 px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#162f16] text-sm"}),(0,d.jsx)("button",{type:"submit",disabled:n||!l.trim(),className:"px-4 py-2 bg-[#162f16] text-white rounded-lg text-sm font-medium hover:bg-[#0f2310] transition disabled:opacity-50",children:n?"Posting...":"Post"})]})]})}function j({post:a,currentUserId:b,onUpdate:c,compact:j=!1}){let k,l,m,n=(0,g.useRouter)(),[o,p]=(0,e.useState)(!1),[q,r]=(0,e.useState)(!1),[s,t]=(0,e.useState)(!1),[u,v]=(0,e.useState)(!1),[w,x]=(0,e.useState)(!1),[y,z]=(0,e.useState)(!1),[A,B]=(0,e.useState)(a.likes_count),[C,D]=(0,e.useState)(a.is_liked),[E,F]=(0,e.useState)(a.comments_count),G=a.user_id===b,H=async c=>{if(a.user_id===b)return;let{error:d}=await f.N.from("notifications").insert({user_id:a.user_id,actor_id:b,type:c,entity_type:"post",entity_id:a.id,meta:{title:a.title}});d&&console.error("Error creating notification:",d)},I=async()=>{if(q)return;r(!0);let d=!C,e=d?A+1:A-1;D(d),B(e);try{C?(await f.N.from("post_likes").delete().eq("post_id",a.id).eq("user_id",b),await f.N.rpc("decrement_likes",{post_id:a.id})):(await f.N.from("post_likes").insert({post_id:a.id,user_id:b}),await f.N.rpc("increment_likes",{post_id:a.id}),await H("like")),c()}catch(a){console.error("Error toggling like:",a),D(!d),B(A)}finally{r(!1)}},J=async d=>{if(!s&&a.event){t(!0);try{let e=a.event.id;if(a.event.user_rsvp===d){await f.N.from("event_rsvps").delete().eq("event_id",e).eq("user_id",b);let c="going"===d?"going_count":"interested_count";await f.N.from("events").update({[c]:Math.max(0,a.event[c]-1)}).eq("id",e)}else if(await f.N.from("event_rsvps").upsert({event_id:e,user_id:b,status:d}),a.event.user_rsvp){let b="going"===a.event.user_rsvp?"going_count":"interested_count",c="going"===d?"going_count":"interested_count";await f.N.from("events").update({[b]:Math.max(0,a.event[b]-1),[c]:a.event[c]+1}).eq("id",e)}else{let b="going"===d?"going_count":"interested_count";await f.N.from("events").update({[b]:a.event[b]+1}).eq("id",e)}c()}catch(a){console.error("Error updating RSVP:",a)}finally{t(!1)}}},K=async()=>{if(!u){v(!0);try{let{error:d}=await f.N.from("posts").delete().eq("id",a.id).eq("user_id",b);if(d)throw d;c(),x(!1)}catch(a){console.error("Error deleting post:",a),alert("Failed to delete post. Please try again.")}finally{v(!1)}}},L=async()=>{if(!b)return void alert("Please sign in to report.");let c=window.prompt("Why are you reporting this post? (optional)")||"",{error:d}=await f.N.from("reports").insert({reporter_id:b,target_post_id:a.id,target_user_id:a.user_id,reason:c});if(d){console.error("Error reporting post:",d),alert("Failed to submit report. Please try again.");return}alert("Report submitted. Thank you.")};return(0,d.jsxs)("div",{className:"bg-white rounded-xl p-6 hover:shadow-md transition",children:[(0,d.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between mb-4",children:[(0,d.jsxs)("div",{className:"flex items-center gap-3 cursor-pointer hover:opacity-80 transition min-w-0",onClick:b=>{b.stopPropagation(),n.push(`/user/${a.user_id}`)},children:[a.user_avatar?(0,d.jsx)(h.default,{src:a.user_avatar,alt:a.user_name,width:40,height:40,className:"w-10 h-10 rounded-full object-cover"}):(0,d.jsx)("div",{className:"w-10 h-10 rounded-full bg-[#162f16] text-white flex items-center justify-center font-semibold",children:a.user_name.charAt(0).toUpperCase()}),(0,d.jsxs)("div",{className:"min-w-0",children:[(0,d.jsx)("p",{className:"font-medium text-gray-900 text-xs hover:underline line-clamp-1",children:a.user_name}),a.user_occupation&&(0,d.jsx)("p",{className:"text-xs text-gray-600 line-clamp-1",children:a.user_occupation}),(0,d.jsx)("p",{className:"text-xs text-gray-500",children:(k=new Date(a.created_at),m=Math.floor((l=Math.floor((new Date().getTime()-k.getTime())/36e5))/24),l<1?"Just now":l<24?`${l}h ago`:m<7?`${m}d ago`:k.toLocaleDateString())})]})]}),(0,d.jsx)("div",{className:"flex items-center gap-2",children:(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsx)("button",{onClick:()=>z(a=>!a),className:"p-2 text-gray-400 hover:text-gray-700 transition","aria-label":"Post actions",children:(0,d.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,d.jsx)("path",{d:"M6 10a2 2 0 11-4 0 2 2 0 014 0zm6 0a2 2 0 11-4 0 2 2 0 014 0zm6 0a2 2 0 11-4 0 2 2 0 014 0z"})})}),y&&(0,d.jsxs)("div",{className:"absolute right-0 top-10 bg-white rounded-lg shadow-lg border border-gray-200 p-2 z-10 w-40",children:[!G&&(0,d.jsx)("button",{onClick:()=>{z(!1),L()},className:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md",children:"Report"}),G&&(0,d.jsx)("button",{onClick:()=>{z(!1),x(!0)},className:"w-full text-left px-3 py-2 text-sm text-red-600 hover:bg-gray-50 rounded-md",children:"Delete"})]}),w&&(0,d.jsxs)("div",{className:"absolute right-0 top-10 bg-white rounded-lg shadow-lg border border-gray-200 p-4 z-10 w-64",children:[(0,d.jsx)("p",{className:"text-sm text-gray-700 mb-3",children:"Are you sure you want to delete this post?"}),(0,d.jsxs)("div",{className:"flex gap-2",children:[(0,d.jsx)("button",{onClick:K,disabled:u,className:"flex-1 px-3 py-2 bg-red-600 text-white rounded-md text-sm font-medium hover:bg-red-700 transition disabled:opacity-50",children:u?"Deleting...":"Delete"}),(0,d.jsx)("button",{onClick:()=>x(!1),className:"flex-1 px-3 py-2 bg-gray-100 text-gray-700 rounded-md text-sm font-medium hover:bg-gray-200 transition",children:"Cancel"})]})]})]})})]}),(0,d.jsx)("h3",{className:`text-l sm:text-base font-regular text-gray-900 mb-2 ${j?"line-clamp-2":""}`,children:a.title}),(0,d.jsx)("p",{className:`text-xs sm:text-xs text-gray-700 mb-4 whitespace-pre-wrap break-words ${j?"line-clamp-3":""}`,children:a.content}),a.event&&(0,d.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 mb-4 border border-gray-200",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-700 mb-2",children:[(0,d.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,d.jsx)("span",{className:"font-medium",children:new Date(a.event.event_date).toLocaleString()})]}),a.event.location&&(0,d.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-700 mb-2",children:[(0,d.jsxs)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),(0,d.jsx)("span",{children:a.event.location})]}),a.event.meeting_link&&(0,d.jsxs)("a",{href:a.event.meeting_link,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-sm text-[#162f16] hover:underline mb-3",children:[(0,d.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})}),(0,d.jsx)("span",{children:"Join Meeting"})]}),(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[(0,d.jsxs)("button",{onClick:()=>J("going"),disabled:s,className:`px-4 py-2 rounded-lg text-sm font-medium transition ${"going"===a.event.user_rsvp?"bg-[#162f16] text-white":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:["Going (",a.event.going_count,")"]}),(0,d.jsxs)("button",{onClick:()=>J("interested"),disabled:s,className:`px-4 py-2 rounded-lg text-sm font-medium transition ${"interested"===a.event.user_rsvp?"bg-[#162f16] text-white":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:["Interested (",a.event.interested_count,")"]})]})]}),a.tags&&a.tags.length>0&&(0,d.jsx)("div",{className:"flex flex-wrap gap-2 mb-4",children:a.tags.map((a,b)=>(0,d.jsxs)("span",{className:"px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium",children:["#",a]},b))}),(0,d.jsxs)("div",{className:"flex flex-wrap items-center gap-4 sm:gap-6 pt-4 border-t border-gray-200",children:[(0,d.jsxs)("button",{onClick:I,disabled:q,className:"flex items-center gap-2 text-gray-600 hover:text-[#162f16] transition",children:[(0,d.jsx)("svg",{className:`w-5 h-5 ${C?"fill-[#162f16] text-[#162f16]":"fill-none"}`,stroke:"currentColor",viewBox:"0 0 24 24",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})}),(0,d.jsx)("span",{className:"text-sm font-medium",children:A})]}),(0,d.jsxs)("button",{onClick:()=>p(!o),className:"flex items-center gap-2 text-gray-600 hover:text-[#162f16] transition",children:[(0,d.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),(0,d.jsx)("span",{className:"text-sm font-medium",children:E})]}),(0,d.jsxs)("button",{onClick:()=>{let b=`${window.location.origin}/community?post=${a.id}`;navigator.clipboard.writeText(b),alert("Link copied to clipboard!")},className:"flex items-center gap-2 text-gray-600 hover:text-[#162f16] transition",children:[(0,d.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})}),(0,d.jsx)("span",{className:"text-sm font-medium",children:"Share"})]})]}),o&&(0,d.jsx)(i,{postId:a.id,currentUserId:b,onUpdate:()=>{F(a=>a+1),c()}})]})}}};