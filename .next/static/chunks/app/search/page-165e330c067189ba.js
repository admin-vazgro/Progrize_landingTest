(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[959],{987:(e,t,l)=>{Promise.resolve().then(l.bind(l,9332))},9332:(e,t,l)=>{"use strict";l.d(t,{default:()=>c});var s=l(5155),a=l(2115),i=l(3321),o=l(5772),r=l(1142),n=l(2338);function c(){let e=(0,i.useRouter)(),t=(0,i.useSearchParams)(),l=(0,a.useMemo)(()=>(t.get("q")||"").trim(),[t]),[c,d]=(0,a.useState)("people"),[m,u]=(0,a.useState)(!1),[x,h]=(0,a.useState)(null),[f,p]=(0,a.useState)([]),[v,_]=(0,a.useState)([]),[w,g]=(0,a.useState)([]),[N,j]=(0,a.useState)([]),[b,y]=(0,a.useState)(new Set);(0,a.useEffect)(()=>{r.N.auth.getUser().then(({data:{user:t}})=>{t?h(t.id):e.push("/")})},[e]),(0,a.useEffect)(()=>{if(!l){p([]),_([]),g([]),j([]);return}(async()=>{u(!0);try{let e=r.N.from("profiles").select("id, full_name, avatar_url, occupation, location").or(`full_name.ilike.%${l}%,occupation.ilike.%${l}%,location.ilike.%${l}%`).limit(12),t=r.N.from("experiences").select("company_name, company_logo, location").ilike("company_name",`%${l}%`).limit(20),s=r.N.from("posts").select("id, title, content, created_at, user_id").eq("post_type","discussion").or(`title.ilike.%${l}%,content.ilike.%${l}%`).order("created_at",{ascending:!1}).limit(10),a=r.N.from("posts").select("id, title, created_at, event_image, events!left(event_date, location)").eq("post_type","event").ilike("title",`%${l}%`).order("created_at",{ascending:!1}).limit(10),[{data:i,error:o},{data:n,error:c},{data:d,error:m},{data:u,error:x}]=await Promise.all([e,t,s,a]);o&&console.error("People search error:",o),c&&console.error("Companies search error:",c),m&&console.error("Discussion search error:",m),x&&console.error("Events search error:",x),p((i||[]).map(e=>({id:e.id,full_name:e.full_name||"User",avatar_url:e.avatar_url,occupation:e.occupation||null,location:e.location||null,company:null})));let h=new Map;(n||[]).forEach(e=>{e.company_name&&(h.has(e.company_name)||h.set(e.company_name,{name:e.company_name,logo:e.company_logo||null,location:e.location||null}))}),_(Array.from(h.values()).slice(0,12));let f=await Promise.all((d||[]).map(async e=>{let{data:t}=await r.N.from("profiles").select("full_name, avatar_url").eq("id",e.user_id).maybeSingle();return{id:e.id,title:e.title,content:e.content,created_at:e.created_at,user_name:t?.full_name||"User",user_avatar:t?.avatar_url||null}}));g(f),j((u||[]).map(e=>({id:e.id,title:e.title,event_image:e.event_image||null,location:e.events?.[0]?.location||null,event_date:e.events?.[0]?.event_date||""})))}finally{u(!1)}})()},[l]),(0,a.useEffect)(()=>{x&&(async()=>{let{data:e}=await r.N.from("follows").select("following_id").eq("follower_id",x);y(new Set((e||[]).map(e=>e.following_id)))})()},[x]);let E=async e=>{if(!x)return;let t=b.has(e);t?await r.N.from("follows").delete().eq("follower_id",x).eq("following_id",e):await r.N.from("follows").insert({follower_id:x,following_id:e}),y(l=>{let s=new Set(l);return t?s.delete(e):s.add(e),s})};return(0,s.jsxs)("div",{className:"min-h-screen bg-[#F6F7F4]",children:[(0,s.jsx)(n.A,{onAuthClick:()=>{e.push("/")}}),(0,s.jsx)("div",{className:"mx-auto max-w-6xl px-4 py-10",children:(0,s.jsxs)("div",{className:"rounded-3xl bg-white p-8 shadow-sm",children:[(0,s.jsxs)("p",{className:"text-sm text-[#6A7A70]",children:["You search for “",l||"...","”"]}),(0,s.jsx)("div",{className:"mt-6 flex flex-wrap gap-6 border-b border-[#E2E6E3] text-sm font-medium text-[#6A7A70]",children:["people","companies","discussion","events"].map(e=>(0,s.jsx)("button",{className:`pb-3 capitalize ${c===e?"text-[#0B2B17] border-b-2 border-[#0B2B17]":"hover:text-[#0B2B17]"}`,onClick:()=>d(e),children:"discussion"===e?"Discussion":e},e))}),(0,s.jsxs)("div",{className:"mt-8",children:[m&&(0,s.jsx)("p",{className:"text-sm text-[#6A7A70]",children:"Loading..."}),!m&&"people"===c&&(0,s.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:f.map(t=>(0,s.jsxs)("div",{className:"rounded-2xl bg-[#F1F1F1] p-6 text-center shadow-sm cursor-pointer hover:shadow-md transition",onClick:()=>e.push(`/user/${t.id}`),children:[(0,s.jsx)("div",{className:"mx-auto h-24 w-24 rounded-full border-4 border-[#F0A44C] overflow-hidden bg-white",children:t.avatar_url?(0,s.jsx)(o.default,{src:t.avatar_url,alt:t.full_name,width:96,height:96,className:"h-full w-full object-cover"}):(0,s.jsx)("div",{className:"h-full w-full flex items-center justify-center text-2xl font-semibold text-[#0B2B17]",children:t.full_name.charAt(0)})}),(0,s.jsx)("h3",{className:"mt-4 font-semibold text-[#0B2B17]",children:t.full_name}),(0,s.jsx)("p",{className:"text-sm text-[#3F4E45]",children:(t.occupation||"Professional")+(t.location?` \xb7 ${t.location}`:"")}),t.company&&(0,s.jsx)("p",{className:"text-xs text-[#6A7A70]",children:t.company}),x&&x!==t.id&&(0,s.jsx)("button",{className:"mt-4 rounded-full bg-[#D6E86A] px-6 py-2 text-sm font-medium text-[#0B2B17]",onClick:e=>{e.stopPropagation(),E(t.id)},children:b.has(t.id)?"Unfollow":"Follow"})]},t.id))}),!m&&"companies"===c&&(0,s.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:v.map(e=>(0,s.jsx)("div",{className:"rounded-2xl bg-white p-6 shadow-sm",children:(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("div",{className:"h-14 w-14 rounded-full bg-[#E7ECE9] flex items-center justify-center",children:e.logo?(0,s.jsx)(o.default,{src:e.logo,alt:e.name,width:48,height:48,className:"h-12 w-12 object-contain"}):(0,s.jsx)("span",{className:"text-xl font-semibold text-[#0B2B17]",children:e.name.charAt(0)})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-semibold text-[#0B2B17]",children:e.name}),e.location&&(0,s.jsx)("p",{className:"text-sm text-[#6A7A70]",children:e.location})]})]})},e.name))}),!m&&"discussion"===c&&(0,s.jsx)("div",{className:"space-y-4",children:w.map(t=>(0,s.jsxs)("div",{className:"rounded-2xl border border-[#E2E6E3] bg-white p-6 shadow-sm cursor-pointer",onClick:()=>e.push(`/community?post=${t.id}`),children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"h-10 w-10 rounded-full overflow-hidden bg-[#E7ECE9]",children:t.user_avatar?(0,s.jsx)(o.default,{src:t.user_avatar,alt:t.user_name,width:40,height:40,className:"h-full w-full object-cover"}):(0,s.jsx)("div",{className:"h-full w-full flex items-center justify-center text-sm font-semibold text-[#0B2B17]",children:t.user_name.charAt(0)})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-[#0B2B17]",children:t.user_name}),(0,s.jsx)("p",{className:"text-xs text-[#6A7A70]",children:new Date(t.created_at).toLocaleDateString()})]})]}),(0,s.jsx)("h3",{className:"mt-4 text-lg font-semibold text-[#0B2B17]",children:t.title}),(0,s.jsx)("p",{className:"mt-2 text-sm text-[#3F4E45] line-clamp-3",children:t.content})]},t.id))}),!m&&"events"===c&&(0,s.jsx)("div",{className:"space-y-4",children:N.map(t=>(0,s.jsx)("div",{className:"rounded-2xl border border-[#E2E6E3] bg-white p-6 shadow-sm cursor-pointer",onClick:()=>e.push(`/community?event=${t.id}`),children:(0,s.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,s.jsx)("div",{className:"w-full md:w-48 h-32 rounded-2xl overflow-hidden bg-[#E7ECE9]",children:t.event_image?(0,s.jsx)(o.default,{src:t.event_image,alt:t.title,width:192,height:128,className:"h-full w-full object-cover"}):(0,s.jsx)("div",{className:"h-full w-full flex items-center justify-center text-sm text-[#6A7A70]",children:"No image"})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-[#0B2B17]",children:t.title}),(0,s.jsxs)("p",{className:"text-sm text-[#6A7A70]",children:[t.location||"Location"," \xb7"," ",t.event_date?new Date(t.event_date).toLocaleDateString():"Date TBD"]})]})]})},t.id))})]})]})})]})}}},e=>{e.O(0,[12,591,338,441,794,358],()=>e(e.s=987)),_N_E=e.O()}]);