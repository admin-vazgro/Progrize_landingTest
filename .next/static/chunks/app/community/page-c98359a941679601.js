(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[28],{1142:(e,t,r)=>{"use strict";r.d(t,{N:()=>s});let s=(0,r(8936).createClient)("https://jfjmpljeavukknfnrbwa.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Impmam1wbGplYXZ1a2tuZm5yYndhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4NjA5ODYsImV4cCI6MjA4MTQzNjk4Nn0.Dc0rOSbzHtq6dtn-Rtg79Jk4DUSJe6RP49gp0r3KwCs")},2846:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var s=r(5155),a=r(2115),n=r(1142),i=r(3321),l=r(9145);function o({isOpen:e,onClose:t,onSuccess:r,userId:i}){let[l,o]=(0,a.useState)("discussion"),[d,c]=(0,a.useState)(""),[m,u]=(0,a.useState)(""),[x,g]=(0,a.useState)(""),[h,p]=(0,a.useState)(!1),[f,v]=(0,a.useState)("");if(!e)return null;let b=async e=>{if(e.preventDefault(),!d.trim()||!m.trim())return void v("Please fill in all required fields");p(!0),v("");try{let e=x.split(",").map(e=>e.trim()).filter(e=>e.length>0),{error:s}=await n.N.from("posts").insert({user_id:i,post_type:l,title:d.trim(),content:m.trim(),tags:e,community_id:null});if(s)throw s;c(""),u(""),g(""),o("discussion"),r(),t()}catch(e){console.error("Error creating post:",e),v("Failed to create post. Please try again.")}finally{p(!1)}};return(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:(0,s.jsxs)("div",{className:"relative w-full max-w-2xl mx-4 bg-white rounded-2xl shadow-2xl p-8 max-h-[90vh] overflow-y-auto",children:[(0,s.jsx)("button",{onClick:t,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition","aria-label":"Close modal",children:(0,s.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,s.jsx)("h2",{className:"text-2xl font-semibold text-gray-900 mb-6",children:"Create Post"}),(0,s.jsxs)("form",{onSubmit:b,className:"space-y-5",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Post Type"}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)("button",{type:"button",onClick:()=>o("discussion"),className:`flex-1 px-4 py-3 rounded-lg border-2 text-sm font-medium transition ${"discussion"===l?"border-[#162f16] bg-[#162f16] text-white":"border-gray-300 text-gray-700 hover:border-gray-400"}`,children:"Discussion"}),(0,s.jsx)("button",{type:"button",onClick:()=>o("job_opportunity"),className:`flex-1 px-4 py-3 rounded-lg border-2 text-sm font-medium transition ${"job_opportunity"===l?"border-[#162f16] bg-[#162f16] text-white":"border-gray-300 text-gray-700 hover:border-gray-400"}`,children:"Job Opportunity"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Title *"}),(0,s.jsx)("input",{type:"text",value:d,onChange:e=>c(e.target.value),placeholder:"Enter a descriptive title",className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#162f16]",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Content *"}),(0,s.jsx)("textarea",{value:m,onChange:e=>u(e.target.value),placeholder:"Share your thoughts...",rows:6,className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#162f16] resize-none",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tags (comma separated)"}),(0,s.jsx)("input",{type:"text",value:x,onChange:e=>g(e.target.value),placeholder:"e.g. design, career, remote",className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#162f16]"})]}),f&&(0,s.jsx)("p",{className:"text-sm text-red-600",children:f}),(0,s.jsxs)("div",{className:"flex items-center gap-3 pt-4",children:[(0,s.jsx)("button",{type:"submit",disabled:h,className:"px-6 py-3 bg-[#162f16] text-white rounded-lg font-medium hover:bg-[#0f2310] transition disabled:opacity-50",children:h?"Posting...":"Post"}),(0,s.jsx)("button",{type:"button",onClick:t,className:"px-6 py-3 bg-white border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition",children:"Cancel"})]})]})]})})}var d=r(5772);function c({postId:e,currentUserId:t,onUpdate:r}){let l=(0,i.useRouter)(),[o,c]=(0,a.useState)([]),[m,u]=(0,a.useState)(""),[x,g]=(0,a.useState)(!1),h=(0,a.useCallback)(async()=>{try{let{data:t,error:r}=await n.N.from("comments").select("*").eq("post_id",e).order("created_at",{ascending:!0});if(r)throw r;let s=await Promise.all((t||[]).map(async e=>{let{data:t}=await n.N.from("profiles").select("full_name, avatar_url").eq("id",e.user_id).single();return{...e,user_name:t?.full_name||"User",user_avatar:t?.avatar_url||""}}));c(s)}catch(e){console.error("Error loading comments:",e)}},[e]);(0,a.useEffect)(()=>{h()},[h]);let p=async s=>{if(s.preventDefault(),m.trim()){g(!0);try{let{error:s}=await n.N.from("comments").insert({post_id:e,user_id:t,content:m.trim()});if(s)throw s;await n.N.rpc("increment_comments",{post_id:e}),u(""),await h(),r()}catch(e){console.error("Error posting comment:",e)}finally{g(!1)}}},f=(e,t)=>{t.stopPropagation(),l.push(`/user/${e}`)};return(0,s.jsxs)("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[(0,s.jsx)("div",{className:"space-y-4 mb-4",children:0===o.length?(0,s.jsx)("p",{className:"text-sm text-gray-500 text-center py-4",children:"No comments yet. Be the first to comment!"}):o.map(e=>{let t,r,a,n;return(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)("div",{className:"cursor-pointer hover:opacity-80 transition",onClick:t=>f(e.user_id,t),children:e.user_avatar?(0,s.jsx)(d.default,{src:e.user_avatar,alt:e.user_name,width:32,height:32,className:"rounded-full object-cover"}):(0,s.jsx)("div",{className:"w-8 h-8 rounded-full bg-[#162f16] text-white flex items-center justify-center text-sm font-semibold",children:e.user_name.charAt(0).toUpperCase()})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3",children:[(0,s.jsx)("p",{className:"font-medium text-sm text-gray-900 cursor-pointer hover:underline",onClick:t=>f(e.user_id,t),children:e.user_name}),(0,s.jsx)("p",{className:"text-sm text-gray-700 mt-1",children:e.content})]}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1 ml-3",children:(t=new Date(e.created_at),n=Math.floor((a=Math.floor((r=Math.floor((new Date().getTime()-t.getTime())/6e4))/60))/24),r<1?"Just now":r<60?`${r}m ago`:a<24?`${a}h ago`:`${n}d ago`)})]})]},e.id)})}),(0,s.jsxs)("form",{onSubmit:p,className:"flex gap-3",children:[(0,s.jsx)("input",{type:"text",value:m,onChange:e=>u(e.target.value),placeholder:"Write a comment...",className:"flex-1 px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#162f16] text-sm"}),(0,s.jsx)("button",{type:"submit",disabled:x||!m.trim(),className:"px-4 py-2 bg-[#162f16] text-white rounded-lg text-sm font-medium hover:bg-[#0f2310] transition disabled:opacity-50",children:x?"Posting...":"Post"})]})]})}function m({post:e,currentUserId:t,onUpdate:r}){let l,o,m,u=(0,i.useRouter)(),[x,g]=(0,a.useState)(!1),[h,p]=(0,a.useState)(!1),[f,v]=(0,a.useState)(!1),[b,y]=(0,a.useState)(!1),[j,N]=(0,a.useState)(!1),[_,w]=(0,a.useState)(e.likes_count),[k,C]=(0,a.useState)(e.is_liked),[S,L]=(0,a.useState)(e.comments_count),q=e.user_id===t,M=async()=>{if(h)return;p(!0);let s=!k,a=s?_+1:_-1;C(s),w(a);try{k?(await n.N.from("post_likes").delete().eq("post_id",e.id).eq("user_id",t),await n.N.rpc("decrement_likes",{post_id:e.id})):(await n.N.from("post_likes").insert({post_id:e.id,user_id:t}),await n.N.rpc("increment_likes",{post_id:e.id})),r()}catch(e){console.error("Error toggling like:",e),C(!s),w(_)}finally{p(!1)}},E=async s=>{if(!f&&e.event){v(!0);try{let a=e.event.id;if(e.event.user_rsvp===s){await n.N.from("event_rsvps").delete().eq("event_id",a).eq("user_id",t);let r="going"===s?"going_count":"interested_count";await n.N.from("events").update({[r]:Math.max(0,e.event[r]-1)}).eq("id",a)}else if(await n.N.from("event_rsvps").upsert({event_id:a,user_id:t,status:s}),e.event.user_rsvp){let t="going"===e.event.user_rsvp?"going_count":"interested_count",r="going"===s?"going_count":"interested_count";await n.N.from("events").update({[t]:Math.max(0,e.event[t]-1),[r]:e.event[r]+1}).eq("id",a)}else{let t="going"===s?"going_count":"interested_count";await n.N.from("events").update({[t]:e.event[t]+1}).eq("id",a)}r()}catch(e){console.error("Error updating RSVP:",e)}finally{v(!1)}}},D=async()=>{if(!b){y(!0);try{let{error:s}=await n.N.from("posts").delete().eq("id",e.id).eq("user_id",t);if(s)throw s;r(),N(!1)}catch(e){console.error("Error deleting post:",e),alert("Failed to delete post. Please try again.")}finally{y(!1)}}};return(0,s.jsxs)("div",{className:"bg-white rounded-xl p-6 border border-gray-200 hover:shadow-md transition",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 cursor-pointer hover:opacity-80 transition",onClick:t=>{t.stopPropagation(),u.push(`/user/${e.user_id}`)},children:[e.user_avatar?(0,s.jsx)(d.default,{src:e.user_avatar,alt:e.user_name,width:40,height:40,className:"rounded-full object-cover"}):(0,s.jsx)("div",{className:"w-10 h-10 rounded-full bg-[#162f16] text-white flex items-center justify-center font-semibold",children:e.user_name.charAt(0).toUpperCase()}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-gray-900 hover:underline",children:e.user_name}),e.user_occupation&&(0,s.jsx)("p",{className:"text-sm text-gray-600",children:e.user_occupation}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:(l=new Date(e.created_at),m=Math.floor((o=Math.floor((new Date().getTime()-l.getTime())/36e5))/24),o<1?"Just now":o<24?`${o}h ago`:m<7?`${m}d ago`:l.toLocaleDateString())})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${(()=>{switch(e.post_type){case"discussion":return"bg-blue-100 text-blue-800";case"job_opportunity":return"bg-green-100 text-green-800";case"event":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}})()}`,children:e.post_type.replace("_"," ")}),q&&(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("button",{onClick:()=>N(!j),className:"p-2 text-gray-400 hover:text-red-600 transition","aria-label":"Delete post",children:(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),j&&(0,s.jsxs)("div",{className:"absolute right-0 top-10 bg-white rounded-lg shadow-lg border border-gray-200 p-4 z-10 w-64",children:[(0,s.jsx)("p",{className:"text-sm text-gray-700 mb-3",children:"Are you sure you want to delete this post?"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{onClick:D,disabled:b,className:"flex-1 px-3 py-2 bg-red-600 text-white rounded-md text-sm font-medium hover:bg-red-700 transition disabled:opacity-50",children:b?"Deleting...":"Delete"}),(0,s.jsx)("button",{onClick:()=>N(!1),className:"flex-1 px-3 py-2 bg-gray-100 text-gray-700 rounded-md text-sm font-medium hover:bg-gray-200 transition",children:"Cancel"})]})]})]})]})]}),(0,s.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:e.title}),(0,s.jsx)("p",{className:"text-gray-700 mb-4 whitespace-pre-wrap",children:e.content}),e.event&&(0,s.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 mb-4 border border-gray-200",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-700 mb-2",children:[(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,s.jsx)("span",{className:"font-medium",children:new Date(e.event.event_date).toLocaleString()})]}),e.event.location&&(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-700 mb-2",children:[(0,s.jsxs)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),(0,s.jsx)("span",{children:e.event.location})]}),e.event.meeting_link&&(0,s.jsxs)("a",{href:e.event.meeting_link,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-sm text-[#162f16] hover:underline mb-3",children:[(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})}),(0,s.jsx)("span",{children:"Join Meeting"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsxs)("button",{onClick:()=>E("going"),disabled:f,className:`px-4 py-2 rounded-lg text-sm font-medium transition ${"going"===e.event.user_rsvp?"bg-[#162f16] text-white":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:["Going (",e.event.going_count,")"]}),(0,s.jsxs)("button",{onClick:()=>E("interested"),disabled:f,className:`px-4 py-2 rounded-lg text-sm font-medium transition ${"interested"===e.event.user_rsvp?"bg-[#162f16] text-white":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:["Interested (",e.event.interested_count,")"]})]})]}),e.tags&&e.tags.length>0&&(0,s.jsx)("div",{className:"flex flex-wrap gap-2 mb-4",children:e.tags.map((e,t)=>(0,s.jsxs)("span",{className:"px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium",children:["#",e]},t))}),(0,s.jsxs)("div",{className:"flex items-center gap-6 pt-4 border-t border-gray-200",children:[(0,s.jsxs)("button",{onClick:M,disabled:h,className:"flex items-center gap-2 text-gray-600 hover:text-[#162f16] transition",children:[(0,s.jsx)("svg",{className:`w-5 h-5 ${k?"fill-[#162f16] text-[#162f16]":"fill-none"}`,stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})}),(0,s.jsx)("span",{className:"text-sm font-medium",children:_})]}),(0,s.jsxs)("button",{onClick:()=>g(!x),className:"flex items-center gap-2 text-gray-600 hover:text-[#162f16] transition",children:[(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),(0,s.jsx)("span",{className:"text-sm font-medium",children:S})]}),(0,s.jsxs)("button",{onClick:()=>{let t=`${window.location.origin}/community?post=${e.id}`;navigator.clipboard.writeText(t),alert("Link copied to clipboard!")},className:"flex items-center gap-2 text-gray-600 hover:text-[#162f16] transition",children:[(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})}),(0,s.jsx)("span",{className:"text-sm font-medium",children:"Share"})]})]}),x&&(0,s.jsx)(c,{postId:e.id,currentUserId:t,onUpdate:()=>{L(e=>e+1),r()}})]})}function u({isOpen:e,onClose:t,onSuccess:r,userId:i}){let[l,o]=(0,a.useState)(""),[c,m]=(0,a.useState)(""),[u,x]=(0,a.useState)(""),[g,h]=(0,a.useState)(""),[p,f]=(0,a.useState)(""),[v,b]=(0,a.useState)(""),[y,j]=(0,a.useState)(""),[N,_]=(0,a.useState)(null),[w,k]=(0,a.useState)(""),[C,S]=(0,a.useState)(!1),[L,q]=(0,a.useState)("");if(!e)return null;let M=async e=>{try{let t=e.name.split(".").pop(),r=`${i}-${Date.now()}.${t}`,s=`event-images/${r}`,{error:a}=await n.N.storage.from("profile-pictures").upload(s,e);if(a)throw console.error("Error uploading image:",a),a;let{data:{publicUrl:l}}=n.N.storage.from("profile-pictures").getPublicUrl(s);return l}catch(e){throw console.error("Error uploading image:",e),e}},E=async e=>{if(e.preventDefault(),!l.trim()||!c.trim()||!u||!g)return void q("Please fill in all required fields");S(!0),q("");try{let e=y.split(",").map(e=>e.trim()).filter(e=>e.length>0),s=new Date(`${u}T${g}`).toISOString(),a=null;if(N)try{a=await M(N)}catch(e){q("Failed to upload image. Please try again."),S(!1);return}let{data:d,error:w}=await n.N.from("posts").insert({user_id:i,post_type:"event",title:l.trim(),content:c.trim(),tags:e,event_image:a,community_id:null}).select().single();if(w)throw w;let{error:C}=await n.N.from("events").insert({post_id:d.id,event_date:s,location:p.trim()||null,meeting_link:v.trim()||null});if(C)throw C;o(""),m(""),x(""),h(""),f(""),b(""),j(""),_(null),k(""),r(),t()}catch(e){console.error("Error creating event:",e),q("Failed to create event. Please try again.")}finally{S(!1)}};return(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:(0,s.jsxs)("div",{className:"relative w-full max-w-2xl mx-4 bg-white rounded-2xl shadow-2xl p-8 max-h-[90vh] overflow-y-auto",children:[(0,s.jsx)("button",{onClick:t,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition","aria-label":"Close modal",children:(0,s.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,s.jsx)("h2",{className:"text-2xl font-semibold text-gray-900 mb-6",children:"Create Event"}),(0,s.jsxs)("form",{onSubmit:E,className:"space-y-5",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Event Image (optional)"}),(0,s.jsx)("div",{className:"flex items-center gap-4",children:w?(0,s.jsxs)("div",{className:"relative w-32 h-32 rounded-lg overflow-hidden",children:[(0,s.jsx)(d.default,{src:w,alt:"Event preview",fill:!0,className:"object-cover"}),(0,s.jsx)("button",{type:"button",onClick:()=>{_(null),k("")},className:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 hover:bg-red-600",children:(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}):(0,s.jsxs)("label",{className:"w-32 h-32 flex flex-col items-center justify-center border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-[#162f16] transition",children:[(0,s.jsx)("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,s.jsx)("span",{className:"text-xs text-gray-500 mt-2",children:"Upload Image"}),(0,s.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{let t=e.target.files?.[0];if(t){_(t);let e=new FileReader;e.onloadend=()=>{k(e.result)},e.readAsDataURL(t)}},className:"hidden"})]})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Event Title *"}),(0,s.jsx)("input",{type:"text",value:l,onChange:e=>o(e.target.value),placeholder:"Enter event title",className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#162f16]",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description *"}),(0,s.jsx)("textarea",{value:c,onChange:e=>m(e.target.value),placeholder:"Describe your event...",rows:4,className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#162f16] resize-none",required:!0})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date *"}),(0,s.jsx)("input",{type:"date",value:u,onChange:e=>x(e.target.value),className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#162f16]",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Time *"}),(0,s.jsx)("input",{type:"time",value:g,onChange:e=>h(e.target.value),className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#162f16]",required:!0})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Location (optional)"}),(0,s.jsx)("input",{type:"text",value:p,onChange:e=>f(e.target.value),placeholder:"e.g. London, UK or Virtual",className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#162f16]"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Meeting Link (optional)"}),(0,s.jsx)("input",{type:"url",value:v,onChange:e=>b(e.target.value),placeholder:"https://zoom.us/... or https://meet.google.com/...",className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#162f16]"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tags (comma separated)"}),(0,s.jsx)("input",{type:"text",value:y,onChange:e=>j(e.target.value),placeholder:"e.g. networking, workshop, career",className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#162f16]"})]}),L&&(0,s.jsx)("p",{className:"text-sm text-red-600",children:L}),(0,s.jsxs)("div",{className:"flex items-center gap-3 pt-4",children:[(0,s.jsx)("button",{type:"submit",disabled:C,className:"px-6 py-3 bg-[#162f16] text-white rounded-lg font-medium hover:bg-[#0f2310] transition disabled:opacity-50",children:C?"Creating...":"Create Event"}),(0,s.jsx)("button",{type:"button",onClick:t,className:"px-6 py-3 bg-white border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition",children:"Cancel"})]})]})]})})}function x({event:e,currentUserId:t,onUpdate:r,onOpenDetail:i}){let[l,o]=(0,a.useState)(!1),[c,m]=(0,a.useState)(!1),u=async s=>{if(!l){o(!0);try{if(e.user_rsvp===s){await n.N.from("event_rsvps").delete().eq("event_id",e.id).eq("user_id",t);let r="going"===s?"going_count":"interested_count";await n.N.from("events").update({[r]:Math.max(0,e[r]-1)}).eq("id",e.id)}else if(await n.N.from("event_rsvps").upsert({event_id:e.id,user_id:t,status:s}),e.user_rsvp){let t="going"===e.user_rsvp?"going_count":"interested_count",r="going"===s?"going_count":"interested_count";await n.N.from("events").update({[t]:Math.max(0,e[t]-1),[r]:e[r]+1}).eq("id",e.id)}else{let t="going"===s?"going_count":"interested_count";await n.N.from("events").update({[t]:e[t]+1}).eq("id",e.id)}r()}catch(e){console.error("Error updating RSVP:",e)}finally{o(!1)}}},x=e.going_count+e.interested_count;return(0,s.jsxs)("div",{className:"bg-white rounded-xl overflow-hidden border border-gray-200 hover:shadow-lg transition cursor-pointer",onClick:()=>i(e.id),children:[(0,s.jsx)("div",{className:"relative h-64 bg-gray-200",children:e.event_image&&!c?(0,s.jsx)(d.default,{src:e.event_image,alt:e.title,fill:!0,className:"object-cover",onError:()=>m(!0)}):(0,s.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-[#162f16] to-[#2a4a2a]",children:(0,s.jsx)("svg",{className:"w-20 h-20 text-white/30",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})})}),(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:e.title}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:e.location||"Virtual Event"}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,s.jsx)("div",{className:"flex -space-x-2",children:e.attendees.slice(0,3).map((e,t)=>e.avatar_url?(0,s.jsx)(d.default,{src:e.avatar_url,alt:e.full_name,width:32,height:32,className:"rounded-full border-2 border-white object-cover",onError:e=>{e.target.style.display="none"}},t):(0,s.jsx)("div",{className:"w-8 h-8 rounded-full border-2 border-white bg-[#162f16] text-white flex items-center justify-center text-xs font-semibold",children:e.full_name.charAt(0).toUpperCase()},t))}),(0,s.jsx)("span",{className:"text-sm text-gray-600",children:x>0?`${x} + Going`:"Be the first to join"})]}),(0,s.jsx)("p",{className:"text-sm text-gray-700 mb-4 line-clamp-3",children:e.content}),(0,s.jsxs)("div",{className:"flex items-center gap-3",onClick:e=>e.stopPropagation(),children:[(0,s.jsx)("button",{onClick:()=>u("going"),disabled:l,className:`flex-1 px-4 py-2 rounded-lg text-sm font-medium transition ${"going"===e.user_rsvp?"bg-[#162f16] text-white":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:"going"===e.user_rsvp?"Going":"I am going"}),(0,s.jsx)("button",{className:"px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-50 transition",children:"Draft"})]})]})]})}function g({eventId:e,currentUserId:t,onClose:r,onUpdate:i}){let[l,o]=(0,a.useState)(null),[c,m]=(0,a.useState)([]),[u,x]=(0,a.useState)(""),[g,h]=(0,a.useState)(!1),[p,f]=(0,a.useState)(!1),[v,b]=(0,a.useState)(!1),[y,j]=(0,a.useState)(!1),[N,_]=(0,a.useState)(!1),[w,k]=(0,a.useState)(!1),C=(0,a.useCallback)(async()=>{if(e)try{let{data:r,error:s}=await n.N.from("events").select(`
          *,
          posts!inner(*)
        `).eq("id",e).single();if(s)throw s;let a=r.posts,{data:i}=await n.N.from("profiles").select("full_name, avatar_url, occupation").eq("id",a.user_id).single(),{data:l}=await n.N.from("event_rsvps").select("status").eq("event_id",e).eq("user_id",t).single(),{data:d}=await n.N.from("event_likes").select("id").eq("event_id",e).eq("user_id",t).single(),{data:c}=await n.N.from("event_rsvps").select("user_id").eq("event_id",e).eq("status","going").limit(5),m=await Promise.all((c||[]).map(async e=>{let{data:t}=await n.N.from("profiles").select("full_name, avatar_url").eq("id",e.user_id).single();return t}));o({...r,post_id:a.id,title:a.title,content:a.content,event_image:a.event_image||null,user_id:a.user_id,host_name:i?.full_name||"User",host_avatar:i?.avatar_url||"",host_occupation:i?.occupation||"",user_rsvp:l?.status||null,attendees:m.filter(e=>null!==e)}),f(!!d)}catch(e){console.error("Error loading event details:",e)}},[e,t]),S=(0,a.useCallback)(async()=>{if(e)try{let{data:t,error:r}=await n.N.from("event_comments").select("*").eq("event_id",e).order("created_at",{ascending:!0});if(r)throw r;let s=await Promise.all((t||[]).map(async e=>{let{data:t}=await n.N.from("profiles").select("full_name, avatar_url").eq("id",e.user_id).single();return{...e,user_name:t?.full_name||"User",user_avatar:t?.avatar_url||""}}));m(s)}catch(e){console.error("Error loading comments:",e)}},[e]);(0,a.useEffect)(()=>{e&&(C(),S())},[e,C,S]);let L=async()=>{if(e)try{p?(await n.N.from("event_likes").delete().eq("event_id",e).eq("user_id",t),await n.N.rpc("decrement_event_likes",{event_id:e})):(await n.N.from("event_likes").insert({event_id:e,user_id:t}),await n.N.rpc("increment_event_likes",{event_id:e})),f(!p),C(),i()}catch(e){console.error("Error toggling like:",e)}},q=async r=>{if(!v&&e&&l){b(!0);try{if(l.user_rsvp===r){await n.N.from("event_rsvps").delete().eq("event_id",e).eq("user_id",t);let s="going"===r?"going_count":"interested_count";await n.N.from("events").update({[s]:Math.max(0,l[s]-1)}).eq("id",e)}else if(await n.N.from("event_rsvps").upsert({event_id:e,user_id:t,status:r}),l.user_rsvp){let t="going"===l.user_rsvp?"going_count":"interested_count",s="going"===r?"going_count":"interested_count";await n.N.from("events").update({[t]:Math.max(0,l[t]-1),[s]:l[s]+1}).eq("id",e)}else{let t="going"===r?"going_count":"interested_count";await n.N.from("events").update({[t]:l[t]+1}).eq("id",e)}C(),i()}catch(e){console.error("Error updating RSVP:",e)}finally{b(!1)}}},M=async()=>{if(!y&&l){j(!0);try{let{error:e}=await n.N.from("posts").delete().eq("id",l.post_id).eq("user_id",t);if(e)throw e;i(),r()}catch(e){console.error("Error deleting event:",e),alert("Failed to delete event. Please try again.")}finally{j(!1),_(!1)}}},E=async r=>{if(r.preventDefault(),u.trim()&&e){h(!0);try{let{error:r}=await n.N.from("event_comments").insert({event_id:e,user_id:t,content:u.trim()});if(r)throw r;await n.N.rpc("increment_event_comments",{event_id:e}),x(""),S(),C(),i()}catch(e){console.error("Error posting comment:",e)}finally{h(!1)}}};if(!e||!l)return null;let D=l.going_count+l.interested_count,P=l.user_id===t;return(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",onClick:r,children:(0,s.jsxs)("div",{className:"relative w-full max-w-3xl mx-4 bg-white rounded-2xl shadow-2xl max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[(0,s.jsx)("button",{onClick:r,className:"absolute top-4 right-4 z-10 text-gray-400 hover:text-gray-600 transition bg-white rounded-full p-2","aria-label":"Close modal",children:(0,s.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),P&&(0,s.jsxs)("div",{className:"absolute top-4 right-16 z-10",children:[(0,s.jsx)("button",{onClick:()=>_(!N),className:"p-2 text-gray-400 hover:text-red-600 transition bg-white rounded-full","aria-label":"Delete event",children:(0,s.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),N&&(0,s.jsxs)("div",{className:"absolute right-0 top-12 bg-white rounded-lg shadow-lg border border-gray-200 p-4 z-20 w-64",children:[(0,s.jsx)("p",{className:"text-sm text-gray-700 mb-3",children:"Are you sure you want to delete this event?"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{onClick:M,disabled:y,className:"flex-1 px-3 py-2 bg-red-600 text-white rounded-md text-sm font-medium hover:bg-red-700 transition disabled:opacity-50",children:y?"Deleting...":"Delete"}),(0,s.jsx)("button",{onClick:()=>_(!1),className:"flex-1 px-3 py-2 bg-gray-100 text-gray-700 rounded-md text-sm font-medium hover:bg-gray-200 transition",children:"Cancel"})]})]})]}),(0,s.jsx)("div",{className:"relative h-72 bg-gray-200 rounded-t-2xl overflow-hidden",children:l.event_image&&!w?(0,s.jsx)(d.default,{src:l.event_image,alt:l.title,fill:!0,className:"object-cover",onError:()=>k(!0)}):(0,s.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-[#162f16] to-[#2a4a2a]",children:(0,s.jsx)("svg",{className:"w-24 h-24 text-white/30",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})})}),(0,s.jsxs)("div",{className:"p-8",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h2",{className:"text-3xl font-semibold text-gray-900 mb-2",children:l.title}),(0,s.jsxs)("p",{className:"text-gray-600",children:[l.location||"Virtual Event"," || ",new Date(l.event_date).toLocaleString("en-US",{month:"long",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,s.jsx)("div",{className:"flex -space-x-2",children:l.attendees.slice(0,3).map((e,t)=>e.avatar_url?(0,s.jsx)(d.default,{src:e.avatar_url,alt:e.full_name,width:40,height:40,className:"rounded-full border-2 border-white object-cover",onError:e=>{e.target.style.display="none"}},t):(0,s.jsx)("div",{className:"w-10 h-10 rounded-full border-2 border-white bg-[#162f16] text-white flex items-center justify-center text-sm font-semibold",children:e.full_name.charAt(0).toUpperCase()},t))}),(0,s.jsx)("span",{className:"text-gray-700 font-medium",children:D>0?`${D} + Going`:"Be the first to join"})]}),l.meeting_link&&(0,s.jsx)("a",{href:l.meeting_link,target:"_blank",rel:"noopener noreferrer",className:"inline-block px-6 py-2 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-200 transition mb-6",children:"Register here"}),(0,s.jsx)("p",{className:"text-gray-700 mb-6 whitespace-pre-wrap",children:l.content}),(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-6 pb-6 border-b border-gray-200",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600 font-medium",children:"Hosted by"}),l.host_avatar?(0,s.jsx)(d.default,{src:l.host_avatar,alt:l.host_name,width:32,height:32,className:"rounded-full object-cover",onError:e=>{e.target.style.display="none"}}):(0,s.jsx)("div",{className:"w-8 h-8 rounded-full bg-[#162f16] text-white flex items-center justify-center text-sm font-semibold",children:l.host_name.charAt(0).toUpperCase()}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900",children:l.host_name}),l.host_occupation&&(0,s.jsx)("p",{className:"text-xs text-gray-600",children:l.host_occupation})]})]}),(0,s.jsx)("div",{className:"flex items-center gap-2 mb-6",children:(0,s.jsxs)("button",{onClick:L,className:"flex items-center gap-2 text-gray-600 hover:text-red-600 transition",children:[(0,s.jsx)("svg",{className:`w-6 h-6 ${p?"fill-red-600 text-red-600":"fill-none"}`,stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})}),(0,s.jsx)("span",{className:"text-sm font-medium",children:l.likes_count||0})]})}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Comments"}),(0,s.jsx)("div",{className:"space-y-4 mb-4",children:0===c.length?(0,s.jsx)("p",{className:"text-sm text-gray-500 text-center py-4",children:"No comments yet. Be the first to comment!"}):c.map(e=>(0,s.jsxs)("div",{className:"flex gap-3",children:[e.user_avatar?(0,s.jsx)(d.default,{src:e.user_avatar,alt:e.user_name,width:32,height:32,className:"rounded-full object-cover",onError:e=>{e.target.style.display="none"}}):(0,s.jsx)("div",{className:"w-8 h-8 rounded-full bg-[#162f16] text-white flex items-center justify-center text-sm font-semibold",children:e.user_name.charAt(0).toUpperCase()}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"font-medium text-sm text-gray-900",children:e.user_name}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mb-2",children:new Date(e.created_at).toLocaleDateString("en-US",{day:"numeric",month:"long",hour:"numeric",minute:"2-digit"})}),(0,s.jsx)("p",{className:"text-sm text-gray-700",children:e.content})]})]},e.id))}),(0,s.jsxs)("form",{onSubmit:E,className:"flex gap-3",children:[(0,s.jsx)("input",{type:"text",value:u,onChange:e=>x(e.target.value),placeholder:"Write a comment...",className:"flex-1 px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#162f16] text-sm"}),(0,s.jsx)("button",{type:"submit",disabled:g||!u.trim(),className:"px-4 py-2 bg-[#162f16] text-white rounded-lg text-sm font-medium hover:bg-[#0f2310] transition disabled:opacity-50",children:g?"Posting...":"Post"})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3 pt-6 border-t border-gray-200",children:[(0,s.jsx)("button",{onClick:()=>{let t=`${window.location.origin}/community?event=${e}`;navigator.clipboard.writeText(t),alert("Link copied to clipboard!")},className:"px-6 py-3 bg-white border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition",children:"Share"}),(0,s.jsx)("button",{onClick:()=>q("going"),disabled:v,className:`flex-1 px-6 py-3 rounded-lg font-medium transition ${"going"===l.user_rsvp?"bg-[#162f16] text-white":"bg-[#162f16] text-white hover:bg-[#0f2310]"}`,children:"going"===l.user_rsvp?"Going":"I am going"})]})]})]})})}function h(){let e,t,r=(0,i.useRouter)(),[d,c]=(0,a.useState)(null),[h,p]=(0,a.useState)(!0),[f,v]=(0,a.useState)([]),[b,y]=(0,a.useState)([]),[j,N]=(0,a.useState)([]),[_,w]=(0,a.useState)(!1),[k,C]=(0,a.useState)(!1),[S,L]=(0,a.useState)(null),[q,M]=(0,a.useState)("feed"),[E,D]=(0,a.useState)("all"),[P,U]=(0,a.useState)("latest"),[$,I]=(0,a.useState)([]),[z,B]=(0,a.useState)(""),W=(0,a.useCallback)(async()=>{let{data:{user:e}}=await n.N.auth.getUser();e?(c(e),p(!1)):r.push("/")},[r]),A=(0,a.useCallback)(async()=>{if(d)try{let e=n.N.from("posts").select(`
          *,
          post_likes!left(user_id),
          events!left(*)
        `);e="latest"===P?e.order("created_at",{ascending:!1}):e.order("likes_count",{ascending:!1});let{data:t,error:r}=await e;if(r)throw r;let s=await Promise.all((t||[]).map(async e=>{let{data:t}=await n.N.from("profiles").select("full_name, avatar_url, occupation").eq("id",e.user_id).single(),r=e.post_likes?.some(e=>e.user_id===d?.id)||!1,s=null;if("event"===e.post_type&&e.events&&e.events.length>0){let t=e.events[0],{data:r}=await n.N.from("event_rsvps").select("status").eq("event_id",t.id).eq("user_id",d?.id).single();s={...t,user_rsvp:r?.status||null}}return{...e,user_name:t?.full_name||"User",user_avatar:t?.avatar_url||"",user_occupation:t?.occupation||"",is_liked:r,event:s}}));v(s)}catch(e){console.error("Error loading posts:",e)}},[d,P]),T=(0,a.useCallback)(async()=>{if(d)try{let e=n.N.from("events").select(`
          *,
          posts!inner(*)
        `);e="latest"===P?e.order("event_date",{ascending:!1}):e.order("going_count",{ascending:!1});let{data:t,error:r}=await e;if(r)throw r;let s=await Promise.all((t||[]).map(async e=>{let t=e.posts,{data:r}=await n.N.from("profiles").select("full_name, avatar_url").eq("id",t.user_id).single(),{data:s}=await n.N.from("event_rsvps").select("status").eq("event_id",e.id).eq("user_id",d?.id).single(),{data:a}=await n.N.from("event_rsvps").select("user_id").eq("event_id",e.id).eq("status","going").limit(5),i=await Promise.all((a||[]).map(async e=>{let{data:t}=await n.N.from("profiles").select("full_name, avatar_url").eq("id",e.user_id).single();return t}));return{...e,post_id:t.id,title:t.title,content:t.content,event_image:t.event_image,user_id:t.user_id,user_name:r?.full_name||"User",user_avatar:r?.avatar_url||"",user_rsvp:s?.status||null,attendees:i.filter(Boolean)}}));y(s)}catch(e){console.error("Error loading events:",e)}},[d,P]),V=(0,a.useCallback)(()=>{let e=[...f];"events"===q&&(e=e.filter(e=>"event"===e.post_type)),"all"!==E&&(e=e.filter(e=>e.post_type===E)),$.length>0&&(e=e.filter(e=>e.tags&&e.tags.some(e=>$.includes(e)))),z.trim()&&(e=e.filter(e=>e.tags&&e.tags.some(e=>e.toLowerCase().includes(z.toLowerCase())))),N(e)},[f,q,E,$,z]),O=(0,a.useCallback)(()=>{let e=[...b];return z.trim()&&(e=e.filter(e=>e.title.toLowerCase().includes(z.toLowerCase())||e.content.toLowerCase().includes(z.toLowerCase()))),e},[b,z]);(0,a.useEffect)(()=>{W()},[W]),(0,a.useEffect)(()=>{A(),T()},[A,T]),(0,a.useEffect)(()=>{V()},[V]);let F=e=>{I(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])};if(h)return(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsx)("p",{className:"text-gray-600",children:"Loading..."})});let R=O();return(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)(l.A,{onAuthClick:()=>{r.push("/")}}),(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-6 py-8",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsxs)("h1",{className:"text-4xl font-regular text-gray-900 mb-2",children:["Welcome Back, ",d?.user_metadata?.full_name||d?.email?.split("@")[0]||"User","\uD83D\uDC4B"]}),(0,s.jsx)("p",{className:"text-gray-600",children:"Connect, share, and grow with fellow professionals"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4 mb-6 border-b border-gray-200",children:[(0,s.jsx)("button",{onClick:()=>M("feed"),className:`pb-3 px-4 font-medium transition ${"feed"===q?"text-[#162f16] border-b-2 border-[#162f16]":"text-gray-600 hover:text-gray-900"}`,children:"Live Feed"}),(0,s.jsx)("button",{onClick:()=>M("events"),className:`pb-3 px-4 font-medium transition ${"events"===q?"text-[#162f16] border-b-2 border-[#162f16]":"text-gray-600 hover:text-gray-900"}`,children:"Events"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[(0,s.jsx)("div",{className:"lg:col-span-1",children:(0,s.jsxs)("div",{className:"bg-white rounded-xl p-6 border border-gray-200 sticky top-6 space-y-6",children:[(0,s.jsx)("div",{children:(0,s.jsx)("input",{type:"text",value:z,onChange:e=>B(e.target.value),placeholder:"Search tags (#JLUX)",className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#162f16] text-sm"})}),"feed"===q&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-700 mb-2 font-medium",children:"Post Type"}),(0,s.jsx)("div",{className:"space-y-2",children:["all","discussion","job_opportunity","event"].map(e=>(0,s.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,s.jsx)("input",{type:"radio",name:"postType",checked:E===e,onChange:()=>D(e),className:"w-4 h-4 text-[#162f16]"}),(0,s.jsx)("span",{className:"text-sm text-gray-700 capitalize",children:e.replace("_"," ")})]},e))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-700 mb-2 font-medium",children:"Tags"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:(e=new Set,f.forEach(t=>{t.tags&&t.tags.forEach(t=>e.add(t))}),Array.from(e)).map(e=>(0,s.jsxs)("button",{onClick:()=>F(e),className:`px-3 py-1 rounded-full text-xs font-medium transition ${$.includes(e)?"bg-[#162f16] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["#",e]},e))})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,s.jsx)("span",{className:"text-lg",children:"\uD83D\uDD25"}),(0,s.jsx)("p",{className:"text-sm text-gray-700 font-medium",children:"Top Hashtag"})]}),(0,s.jsx)("div",{className:"space-y-2",children:(t=new Map,f.forEach(e=>{e.tags&&e.tags.forEach(e=>{t.set(e,(t.get(e)||0)+1)})}),Array.from(t.entries()).sort((e,t)=>t[1]-e[1]).slice(0,5)).map(([e,t])=>(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("button",{onClick:()=>F(e),className:"text-sm text-gray-700 hover:text-[#162f16] transition",children:["#",e]}),(0,s.jsx)("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 rounded-full text-xs font-medium",children:t})]},e))})]})]})}),(0,s.jsxs)("div",{className:"lg:col-span-3",children:[(0,s.jsxs)("div",{className:"bg-white rounded-xl p-4 mb-6 border border-gray-200 flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("button",{onClick:()=>w(!0),className:"px-4 py-2 bg-[#162f16] text-white rounded-md text-sm font-medium hover:bg-[#0f2310] transition",children:"Create Post"}),"events"===q&&(0,s.jsx)("button",{onClick:()=>C(!0),className:"px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-md text-sm font-medium hover:bg-gray-50 transition",children:"Create Event"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-sm text-gray-600",children:"Sort by:"}),(0,s.jsxs)("select",{value:P,onChange:e=>U(e.target.value),className:"px-3 py-1 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-[#162f16]",children:[(0,s.jsx)("option",{value:"latest",children:"Latest"}),(0,s.jsx)("option",{value:"top",children:"Top"})]})]})]}),"feed"===q?(0,s.jsx)("div",{className:"space-y-4",children:0===j.length?(0,s.jsx)("div",{className:"bg-white rounded-xl p-12 text-center border border-gray-200",children:(0,s.jsx)("p",{className:"text-gray-600",children:"No posts found. Be the first to post!"})}):j.map(e=>(0,s.jsx)(m,{post:e,currentUserId:d?.id||"",onUpdate:A},e.id))}):(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:0===R.length?(0,s.jsx)("div",{className:"col-span-2 bg-white rounded-xl p-12 text-center border border-gray-200",children:(0,s.jsx)("p",{className:"text-gray-600",children:"No events found. Create the first event!"})}):R.map(e=>(0,s.jsx)(x,{event:e,currentUserId:d?.id||"",onUpdate:T,onOpenDetail:L},e.id))})]})]})]}),(0,s.jsx)(o,{isOpen:_,onClose:()=>w(!1),onSuccess:A,userId:d?.id||""}),(0,s.jsx)(u,{isOpen:k,onClose:()=>C(!1),onSuccess:()=>{A(),T()},userId:d?.id||""}),(0,s.jsx)(g,{eventId:S,currentUserId:d?.id||"",onClose:()=>L(null),onUpdate:()=>{A(),T()}})]})}},5591:(e,t,r)=>{Promise.resolve().then(r.bind(r,2846))},9145:(e,t,r)=>{"use strict";r.d(t,{A:()=>m});var s=r(5155),a=r(2115),n=r(1142),i=r(5772),l=r(8500),o=r.n(l),d=r(3321);let c={src:"/_next/static/media/logo.35068b4e.svg",height:46,width:159,blurWidth:0,blurHeight:0};function m({onAuthClick:e}){let t=(0,d.useRouter)(),r=(0,d.usePathname)(),[l,m]=(0,a.useState)(null),[u,x]=(0,a.useState)(!1),[g,h]=(0,a.useState)(!1);(0,a.useEffect)(()=>{n.N.auth.getSession().then(({data:{session:e}})=>{m(e?.user??null)});let{data:{subscription:e}}=n.N.auth.onAuthStateChange((e,t)=>{m(t?.user??null)});return()=>e.unsubscribe()},[]);let p=async()=>{await n.N.auth.signOut(),x(!1),t.push("/")},f=()=>{l?t.push("/community"):e("sign_in"),h(!1)},v=()=>l?.user_metadata?.avatar_url||"";return(0,s.jsxs)("header",{className:"py-6 bg-white border-b border-gray-100 sticky top-0 z-40",children:[(0,s.jsxs)("div",{className:"container mx-auto flex items-center justify-between px-4",children:[(0,s.jsx)("div",{className:"flex items-center gap-3",children:(0,s.jsx)(o(),{href:"/",children:(0,s.jsx)(i.default,{src:c,alt:"Progrize logo",className:"w-auto h-8"})})}),(0,s.jsxs)("nav",{className:"hidden md:flex items-center gap-10 text-sm tracking-wider text-gray-600",children:[(0,s.jsx)("a",{href:"#features",className:"hover:text-[#162f16] transition",children:"Features"}),(0,s.jsx)("a",{href:"#testimonials",className:"hover:text-[#162f16] transition",children:"Testimonials"}),(0,s.jsx)("a",{href:"/upcoming",className:"hover:text-[#162f16] transition",children:"Resources"}),(0,s.jsx)("button",{onClick:f,className:`hover:text-[#162f16] transition ${"/community"===r?"text-[#162f16] font-semibold":""}`,children:"Community"})]}),(0,s.jsx)("div",{className:"hidden md:flex items-center gap-4",children:l?(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("button",{onClick:()=>x(!u),className:"flex items-center gap-3 hover:opacity-80 transition",children:[v()?(0,s.jsx)(i.default,{src:v(),alt:"Profile",width:40,height:40,className:"rounded-full object-cover"}):(0,s.jsx)("div",{className:"w-10 h-10 rounded-full bg-[#162f16] text-white flex items-center justify-center font-semibold",children:l?.user_metadata?.first_name?l.user_metadata.first_name.charAt(0).toUpperCase():l?.email?l.email.charAt(0).toUpperCase():"U"}),(0,s.jsx)("span",{className:"text-gray-900 font-medium",children:l?.user_metadata?.first_name?`${l.user_metadata.first_name} ${l.user_metadata.last_name||""}`.trim():l?.email?l.email.split("@")[0]:"User"}),(0,s.jsx)("svg",{className:`w-4 h-4 text-gray-600 transition-transform ${u?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),u&&(0,s.jsxs)("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-50",children:[(0,s.jsx)("button",{onClick:()=>{t.push("/profile"),x(!1)},className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:"Profile"}),(0,s.jsx)("button",{onClick:()=>{t.push("/community"),x(!1)},className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:"Community"}),(0,s.jsx)("button",{onClick:()=>x(!1),className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:"Settings"}),(0,s.jsx)("hr",{className:"my-2 border-gray-200"}),(0,s.jsx)("button",{onClick:p,className:"w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-50",children:"Sign Out"})]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:()=>e("sign_in"),className:"px-4 py-2 text-gray-700 hover:text-gray-900 transition",children:"Sign In"}),(0,s.jsx)("button",{onClick:()=>e("sign_up"),className:"px-4 py-2 bg-[#162f16] text-white rounded-md hover:bg-[#0f2310] transition",children:"Sign Up"})]})}),(0,s.jsx)("button",{onClick:()=>h(!g),"aria-label":"Open menu",className:"md:hidden p-2",children:g?(0,s.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})}):(0,s.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})})})]}),(0,s.jsx)("div",{className:`md:hidden transition-all duration-300 overflow-hidden ${g?"max-h-96 opacity-100":"max-h-0 opacity-0"}`,children:(0,s.jsxs)("nav",{className:"flex flex-col gap-4 px-6 py-4 bg-white border-t border-gray-200 text-sm tracking-wide",children:[(0,s.jsx)("a",{href:"#features",className:"py-2 hover:text-[#162f16]",onClick:()=>h(!1),children:"Features"}),(0,s.jsx)("a",{href:"#testimonials",className:"py-2 hover:text-[#162f16]",onClick:()=>h(!1),children:"Testimonials"}),(0,s.jsx)("a",{href:"/upcoming",className:"py-2 hover:text-[#162f16]",onClick:()=>h(!1),children:"Resources"}),(0,s.jsx)("button",{onClick:f,className:"text-left py-2 hover:text-[#162f16]",children:"Community"}),l?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:()=>{t.push("/profile"),h(!1)},className:"text-left py-2 hover:text-[#162f16]",children:"Profile"}),(0,s.jsx)("button",{onClick:p,className:"text-left py-2 text-red-600 hover:text-red-700",children:"Sign Out"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:()=>{e("sign_in"),h(!1)},className:"text-left py-2 hover:text-[#162f16]",children:"Sign In"}),(0,s.jsx)("button",{onClick:()=>{e("sign_up"),h(!1)},className:"mt-2 px-4 py-2 bg-[#162f16] text-white text-center rounded-md",children:"Sign Up"})]})]})})]})}}},e=>{e.O(0,[12,591,441,794,358],()=>e(e.s=5591)),_N_E=e.O()}]);