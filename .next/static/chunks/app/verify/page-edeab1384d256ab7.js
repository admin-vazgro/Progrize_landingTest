(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[434],{1142:(e,i,t)=>{"use strict";t.d(i,{N:()=>r});let r=(0,t(8936).createClient)("https://jfjmpljeavukknfnrbwa.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Impmam1wbGplYXZ1a2tuZm5yYndhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4NjA5ODYsImV4cCI6MjA4MTQzNjk4Nn0.Dc0rOSbzHtq6dtn-Rtg79Jk4DUSJe6RP49gp0r3KwCs")},3135:(e,i,t)=>{Promise.resolve().then(t.bind(t,5792))},5792:(e,i,t)=>{"use strict";t.d(i,{default:()=>l});var r=t(5155),s=t(2115),a=t(1142),n=t(3321);function l(){let e=(0,n.useRouter)(),i=(0,n.useSearchParams)().get("token"),[t,l]=(0,s.useState)(!0),[d,o]=(0,s.useState)(null),[c,m]=(0,s.useState)(null),[u,x]=(0,s.useState)(!1),[f,h]=(0,s.useState)(""),[p,g]=(0,s.useState)(!1);(0,s.useEffect)(()=>{y()},[i]);let y=async()=>{if(!i){m("Invalid verification link"),l(!1);return}try{let e,{data:t,error:r}=await a.N.from("verification_requests").select("*").eq("verification_token",i).maybeSingle();if(r)throw r;if(!t){m("Invalid or expired verification link"),l(!1);return}if("pending"!==t.status){m(`This verification request has already been ${t.status}`),l(!1);return}if(new Date(t.expires_at)<new Date){await a.N.from("verification_requests").update({status:"expired"}).eq("id",t.id),m("This verification link has expired"),l(!1);return}if("experience"===t.request_type){let{data:i}=await a.N.from("experiences").select("position, company_name, start_date, end_date, is_current, description").eq("id",t.reference_id).single();e={title:i?.position||"",organization:i?.company_name||"",start_date:i?.start_date||"",end_date:i?.end_date,is_current:i?.is_current||!1,description:i?.description}}else{let{data:i}=await a.N.from("education").select("degree, institution_name, start_date, end_date, is_current, description").eq("id",t.reference_id).single();e={title:i?.degree||"",organization:i?.institution_name||"",start_date:i?.start_date||"",end_date:i?.end_date,is_current:i?.is_current||!1,description:i?.description}}o({...t,user_name:t.user_name||"Unknown User",user_email:t.user_email||"",item_details:e})}catch(e){console.error("Error loading verification details:",e),m({message:e?.message,code:e?.code,details:e?.details,hint:e?.hint}.message||"Failed to load verification details")}finally{l(!1)}},v=async()=>{if(d){x(!0);try{let{error:i}=await a.N.from("verification_requests").update({status:"verified",verified_at:new Date().toISOString(),verified_by:d.verifier_email}).eq("id",d.id);if(i)throw i;let t="experience"===d.request_type?"experiences":"education",{error:r}=await a.N.from(t).update({verified:!0,verified_by:d.verifier_email,verified_at:new Date().toISOString()}).eq("id",d.reference_id);if(r)throw r;await a.N.from("verification_history").insert({verification_request_id:d.id,action:"verified",actor_email:d.verifier_email,notes:"Verified successfully"});try{await a.N.functions.invoke("send-verification-notification",{body:{userEmail:d.user_email,userName:d.user_name,requestType:d.request_type,itemDetails:{title:d.item_details.title,organization:d.item_details.organization},status:"verified",verifiedBy:d.verifier_email}})}catch(e){console.error("Error sending notification email:",e)}e.push("/verification-success")}catch(e){console.error("Error verifying:",e),alert("Failed to verify. Please try again.")}finally{x(!1)}}},j=async()=>{if(d){if(!f.trim())return void alert("Please provide a reason for rejection");x(!0);try{let{error:i}=await a.N.from("verification_requests").update({status:"rejected",verified_at:new Date().toISOString(),verified_by:d.verifier_email,rejection_reason:f}).eq("id",d.id);if(i)throw i;await a.N.from("verification_history").insert({verification_request_id:d.id,action:"rejected",actor_email:d.verifier_email,notes:f});try{await a.N.functions.invoke("send-verification-notification",{body:{userEmail:d.user_email,userName:d.user_name,requestType:d.request_type,itemDetails:{title:d.item_details.title,organization:d.item_details.organization},status:"rejected",verifiedBy:d.verifier_email,rejectionReason:f}})}catch(e){console.error("Error sending notification email:",e)}e.push("/verification-rejected")}catch(e){console.error("Error rejecting:",e),alert("Failed to reject. Please try again.")}finally{x(!1)}}},_=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});return t?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#162f16] mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Loading verification details..."})]})}):c?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:(0,r.jsxs)("div",{className:"max-w-md w-full bg-white rounded-xl shadow-lg p-8 text-center",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,r.jsx)("h2",{className:"text-2xl font-semibold text-gray-900 mb-2",children:"Verification Error"}),(0,r.jsx)("p",{className:"text-gray-600",children:c})]})}):d?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 py-12 px-4",children:(0,r.jsxs)("div",{className:"max-w-3xl mx-auto",children:[(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden",children:[(0,r.jsxs)("div",{className:"bg-[#162f16] text-white p-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold mb-2",children:"Verification Request"}),(0,r.jsxs)("p",{className:"text-gray-300",children:[d.user_name," has requested verification of their"," ",d.request_type]})]}),(0,r.jsxs)("div",{className:"p-6 space-y-6",children:[(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-900 mb-3",children:"Requester Information"}),(0,r.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Name:"}),(0,r.jsx)("span",{className:"text-gray-900 font-medium",children:d.user_name})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Request Date:"}),(0,r.jsx)("span",{className:"text-gray-900 font-medium",children:_(d.created_at)})]})]})]}),(0,r.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,r.jsxs)("h3",{className:"font-semibold text-gray-900 mb-3",children:["experience"===d.request_type?"Experience":"Education"," Details"]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm text-gray-600",children:"experience"===d.request_type?"Position:":"Degree:"}),(0,r.jsx)("p",{className:"text-gray-900 font-medium",children:d.item_details.title})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm text-gray-600",children:"experience"===d.request_type?"Company:":"Institution:"}),(0,r.jsx)("p",{className:"text-gray-900 font-medium",children:d.item_details.organization})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm text-gray-600",children:"Period:"}),(0,r.jsxs)("p",{className:"text-gray-900 font-medium",children:[_(d.item_details.start_date)," -"," ",d.item_details.is_current?"Present":_(d.item_details.end_date||"")]})]}),d.item_details.description&&(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm text-gray-600",children:"Description:"}),(0,r.jsx)("p",{className:"text-gray-700 text-sm mt-1",children:d.item_details.description})]})]})]}),d.message&&(0,r.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-900 mb-2",children:"Additional Message"}),(0,r.jsx)("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:d.message})]}),p&&(0,r.jsxs)("div",{className:"border border-red-200 bg-red-50 rounded-lg p-4",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-900 mb-2",children:"Reason for Rejection *"}),(0,r.jsx)("textarea",{value:f,onChange:e=>h(e.target.value),rows:4,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",placeholder:"Please provide a detailed reason for rejecting this verification..."})]}),(0,r.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)("svg",{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),(0,r.jsxs)("div",{className:"text-sm text-blue-800",children:[(0,r.jsx)("p",{className:"font-medium mb-1",children:"Please verify the following:"}),(0,r.jsxs)("ul",{className:"list-disc list-inside space-y-1",children:[(0,r.jsx)("li",{children:"The person worked/studied at your organization"}),(0,r.jsx)("li",{children:"The position/degree title is accurate"}),(0,r.jsx)("li",{children:"The dates are correct"}),(0,r.jsx)("li",{children:"All information matches your records"})]})]})]})}),(0,r.jsx)("div",{className:"flex gap-3 pt-4",children:p?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:()=>{g(!1),h("")},disabled:u,className:"flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition font-medium disabled:opacity-50",children:"Cancel"}),(0,r.jsx)("button",{onClick:j,disabled:u||!f.trim(),className:"flex-1 px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition font-medium disabled:opacity-50",children:u?"Processing...":"Confirm Rejection"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:()=>g(!0),disabled:u,className:"flex-1 px-6 py-3 border-2 border-red-600 text-red-600 rounded-lg hover:bg-red-50 transition font-medium disabled:opacity-50",children:"Reject"}),(0,r.jsx)("button",{onClick:v,disabled:u,className:"flex-1 px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition font-medium disabled:opacity-50",children:u?"Processing...":"Verify & Approve"})]})})]})]}),(0,r.jsxs)("p",{className:"text-center text-sm text-gray-500 mt-6",children:["This verification link will expire on ",_(d.expires_at||"")]})]})}):null}}},e=>{e.O(0,[12,441,794,358],()=>e(e.s=3135)),_N_E=e.O()}]);